<div class="min-h-screen bg-gray-50 p-6">
  <div class="max-w-7xl mx-auto">
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-4">Dashboard</h1>
      <input
        type="text"
        placeholder="Search by user, food, or date..."
        class="w-full max-w-md px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
        [value]="searchTerm()"
        (input)="onSearchChange($any($event.target).value)"
      />
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-lg font-semibold text-gray-600 mb-2">Submissions Today</h3>
        <p class="text-3xl font-bold text-gray-900">{{ submissionsToday() }}</p>
      </div>
      <div class="bg-white rounded-xl shadow-sm p-6">
        <h3 class="text-lg font-semibold text-gray-600 mb-2">Pending Review</h3>
        <p class="text-3xl font-bold text-gray-900">{{ pendingReview() }}</p>
      </div>
    </div>

    <div class="flex space-x-4 mb-6 overflow-x-auto pb-2">
      <button
        *ngFor="let status of ['all', 'pending', 'approved', 'rejected']"
        (click)="onStatusChange( $any(status) )"
        [class]="selectedStatus() === status ? 
          'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold whitespace-nowrap' : 
          'bg-white text-gray-700 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 whitespace-nowrap'"
      >
        {{ status === 'all' ? 'All' : (status === 'pending' ? 'Pending' : status === 'approved' ? 'Approved' : 'Rejected') }}
      </button>
    </div>

    <div class="bg-white rounded-xl shadow-sm">
      @if (isLoading()) {
        <div class="flex justify-center items-center py-12">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"></div>
        </div>
      } @else {
        <div class="divide-y divide-gray-200">
          @for (order of filteredOrders(); track order.id) {
            <div class="p-6">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <h3 class="text-lg font-semibold text-gray-900">
                    <!-- Added the indexer [0] to access the first item in the array -->
                    {{ order.items![0].foodItem.name }}
                    @if (order.items.length > 1) {
                      <span class="text-gray-500">+{{ order.items.length - 1 }} more</span>
                    }
                  </h3>
                  <p class="text-gray-600">{{ order.customerInfo.fullName }}</p>
                  <span class="inline-block px-2 py-1 rounded-full text-xs font-semibold {{ getStatusColor(order.status) }}">
                    {{ order.status === 'pending' ? 'Pending' : order.status === 'approved' ? 'Approved' : order.status === 'rejected' ? 'Rejected' : order.status }}
                  </span>
                </div>
                <div class="text-right">
                  <p class="text-gray-500 text-sm">{{ order.createdAt | date:'MMM d, h:mm a' }}</p>
                  <p class="text-lg font-semibold text-gray-900">${{ order.total }}</p>
                </div>
              </div>

              <div class="flex justify-between items-center">
                <button class="text-green-600 hover:text-green-700 font-semibold">
                  View Details
                </button>
                
                @if (order.status === 'pending') {
                  <div class="flex space-x-2">
                    <button
                      (click)="updateOrderStatus(order.id, 'rejected')"
                      class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors"
                    >
                      Reject
                    </button>
                    <button
                      (click)="updateOrderStatus(order.id, 'approved')"
                      class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
                    >
                      Approve
                    </button>
                  </div>
                }
              </div>
            </div>
          }
          @empty {
            <div class="text-center py-12">
              <p class="text-gray-500 text-lg">No orders found</p>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
